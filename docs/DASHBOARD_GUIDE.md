# GlobalID Dashboard 使用指南

## 🚀 启动仪表盘

```bash
# 启动仪表盘
./venv/bin/streamlit run src/dashboard/app.py

# 或指定端口
./venv/bin/streamlit run src/dashboard/app.py --server.port 8502
```

访问地址：http://localhost:8502

## 📊 主要功能

### 1️⃣ 总览 (Overview)

**核心改进：**
- ✅ **修复了"Total"疾病bug** - 现在使用所有疾病的汇总数据
- 📊 **Top 10疾病排名** - 快速查看最严重的疾病
- 📈 **灵活趋势图** - 可选择时间范围和单个疾病
- 📥 **数据导出** - 一键下载CSV

**使用技巧：**
- 通过侧边栏选择国家（默认：China）
- 选择时间范围：30天/90天/1年/所有时间
- 选择疾病筛选：查看特定疾病或全部疾病趋势
- 展开"原始数据"查看详细数据表格

### 2️⃣ 疾病分析 (Disease Analysis)

**新增功能：**
- 🔍 **智能疾病选择** - 只显示有数据的51个疾病
- 📊 **多维度分析**：
  - 病例趋势图（面积图）
  - 死亡趋势图（柱状图）
  - 发病率/死亡率趋势
- 🆚 **疾病对比模式** - 多选疾病进行横向对比
- 📈 **统计指标**：累计病例、累计死亡、CFR（病死率）、月均病例

**使用技巧：**
- 点击"对比"复选框进入对比模式
- 使用多选框选择2-5个疾病进行对比
- 切换标签页查看不同维度的趋势

### 3️⃣ 数据浏览 (Data Explorer)

**快捷查询模板：**
1. **最近100条记录** - 查看最新数据
2. **疾病汇总统计** - 各疾病的总病例/死亡数
3. **月度汇总数据** - 最近24个月的月度统计
4. **数据质量概览** - 快速查看数据质量指标

**表格浏览器：**
- 支持浏览5个核心表：
  - `disease_records` - 主数据表
  - `diseases` - 疾病定义
  - `countries` - 国家列表
  - `standard_diseases` - 标准疾病库
  - `disease_mappings` - 疾病名称映射

### 4️⃣ 数据质量 (Data Quality)

**数据质量仪表盘 - 新增功能！**

监控指标：
- 📊 总记录数、疾病数、日期范围
- 🔍 零值统计（零病例/零死亡记录占比）
- 📅 时间序列完整性检查
- 📈 数据来源分布（饼图）

**重要发现：**
- ✓ 时间序列连续无间断（192个月）
- ✓ 无孤立记录、无NULL值
- ✓ 数据来源：63.3% CDC报告 + 20.9% 周报 + 14.8% 政府数据

## 🎨 界面优化

### 改进点：
1. **更清晰的布局** - 使用列布局和标签页组织内容
2. **更好的配色** - Plotly白色主题，统一配色方案
3. **响应式设计** - 自适应容器宽度
4. **中英双语** - 完整的i18n支持

### 交互优化：
- 🎯 更直观的过滤器
- 📊 交互式图表（缩放、悬停提示）
- 💾 快捷数据导出
- 🔄 智能刷新机制

## 🔧 技术改进

### 关键修复：
1. ✅ **修复"Total"疾病引用** - 改为动态汇总所有疾病
2. ✅ **优化SQL查询** - 只查询有数据的疾病
3. ✅ **改进错误处理** - 更友好的错误提示
4. ✅ **性能优化** - 减少不必要的数据库查询

### 数据库优化：
```sql
-- 示例：优化后的趋势查询
SELECT date_trunc('month', r.time) AS time_period, 
       SUM(r.cases) AS cases,
       SUM(r.deaths) AS deaths
FROM disease_records r
JOIN diseases d ON r.disease_id = d.id
WHERE r.country_id = 1 
  AND r.time > NOW() - INTERVAL '365 days'
GROUP BY time_period
ORDER BY time_period
```

## 📝 常见问题

### Q: 为什么Overview显示的疾病数是51而不是127？
A: 127是标准疾病库中的总数，51是中国历史数据中实际出现过的疾病数。仪表盘只显示有数据的疾病，避免混淆。

### Q: 如何导出特定时间段的数据？
A: 
1. 选择时间范围
2. 点击趋势图下方"原始数据"展开
3. 点击"下载CSV"按钮

### Q: 疾病对比最多支持几个疾病？
A: 建议2-5个，过多会导致图表拥挤。

### Q: 数据多久更新一次？
A: 最新数据：2025-12-01（根据数据源）

## 🚀 后续优化计划

### 短期（已完成）：
- ✅ 修复Total疾病bug
- ✅ 添加Top疾病排名
- ✅ 添加疾病对比功能
- ✅ 添加数据质量仪表盘
- ✅ 优化UI/UX

### 中期（计划中）：
- 🔄 添加地图可视化
- 🔄 添加预测功能
- 🔄 添加报告生成器
- 🔄 添加API文档

### 长期（愿景）：
- 🌐 多国数据支持
- 🤖 AI异常检测
- 📧 邮件告警
- 👥 用户权限管理

## 📞 技术支持

遇到问题？
1. 查看日志：Streamlit启动时的终端输出
2. 检查数据库连接：确保PostgreSQL运行中
3. 运行数据质量检查：`venv/bin/python scripts/check_data_quality.py`

---

**版本**: v2.0  
**最后更新**: 2026-02-11  
**维护者**: GlobalID Team
